<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PARAMO Tutorial • SCATE.shortcourse</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="PARAMO Tutorial">
<meta property="og:description" content="SCATE.shortcourse">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">SCATE.shortcourse</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/01_rphenoscape.html">RPhenoscape Tutorial</a>
    </li>
    <li>
      <a href="../articles/PARAMO.html">PARAMO Tutorial</a>
    </li>
    <li>
      <a href="../articles/glossary.html">Glossary</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/phenoscape/scate-shortcourse/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>PARAMO Tutorial</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/phenoscape/scate-shortcourse/blob/HEAD/vignettes/PARAMO.Rmd" class="external-link"><code>vignettes/PARAMO.Rmd</code></a></small>
      <div class="hidden name"><code>PARAMO.Rmd</code></div>

    </div>

    
    
<p><img src="https://github.com/sergeitarasov/PARAMO/raw/master/icon-paramo.png"><!-- --></p>
<p><em><strong>P</strong>hylogenetic <strong>A</strong>ncestral
<strong>R</strong>econstruction of <strong>A</strong>natomy by
<strong>M</strong>apping <strong>O</strong>ntologies</em></p>
<p>The <span class="math inline">\(PARAMO\)</span> pipeline requires
three initial pieces of data: a character matrix, a dated phylogeny, and
an anatomy ontology. Herein, we use a set of 19 characters from
OntoTrace and a large-scale phylogeny of fishes from <span class="citation">[@rabosky2018]</span>. In this demonstration, we are
interested in constructing the amalgamated characters for the three
levels of amalgamation (=anatomical hierarchy): anatomical dependencies
(ADs), body regions (BRs) and entire phenotype (EF). At the BR level,
three main body types are considered – “dermatocranium”, “paired fins”
and “external integument structures”.</p>
<div class="section level2">
<h2 id="step-1--initial-character-matrix">STEP 1. Initial character matrix<a class="anchor" aria-label="anchor" href="#step-1--initial-character-matrix"></a>
</h2>
<p>We are going to retrieve our dataset from the Phenoscape
Knowledgebase for demonstration purposes as our starting point. We are
then going to reconstruct the history of these traits accounting for
dependencies among them and amalgamating them according to trait type
using the UBERON Anatomy Ontology.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Define our traits</span></span>
<span><span class="va">terms</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"dermatocranium"</span>, <span class="st">"paired fin"</span>, <span class="st">"barbel"</span><span class="op">)</span> </span>
<span><span class="co"># Define our taxon</span></span>
<span><span class="va">taxon</span> <span class="op">&lt;-</span> <span class="st">"Siluriformes"</span>   </span>
<span></span>
<span><span class="co"># Apply pk_get_ontotrace_xml over all our traits in our taxon of interest, the Siluriformes and retain</span></span>
<span><span class="co"># variable characters. If you want to return invariant characters instead, select variable_only=FALSE. </span></span>
<span><span class="va">nex</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">terms</span>, <span class="va">pk_get_ontotrace_xml</span>, taxon<span class="op">=</span><span class="va">taxon</span>, variable_only<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">nex</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">terms</span></span>
<span></span>
<span><span class="va">.m</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">nex</span>, <span class="va">pk_get_ontotrace</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Merge together the resulting 3 matrices and remove non-trait data (OTU identifiers) and duplicated columns (if present)</span></span>
<span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/reduce.html" class="external-link">reduce</a></span><span class="op">(</span><span class="va">.m</span>, <span class="va">full_join</span>, by<span class="op">=</span><span class="st">"taxa"</span>, suffix<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">""</span>, <span class="st">".y"</span><span class="op">)</span><span class="op">)</span>  </span>
<span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select_all.html" class="external-link">select_at</a></span><span class="op">(</span><span class="va">m</span>, <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="op">-</span><span class="fu">contains</span><span class="op">(</span><span class="st">"otu"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="co"># Removes otu data</span></span>
<span><span class="va">siluriformes</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select_all.html" class="external-link">select_at</a></span><span class="op">(</span><span class="va">m</span>, <span class="fu">vars</span><span class="op">(</span><span class="op">-</span><span class="fu">contains</span><span class="op">(</span><span class="st">".y"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="co"># Removes duplicated columns</span></span>
<span><span class="fu"><a href="../reference/print_coverage.html">print_coverage</a></span><span class="op">(</span><span class="va">siluriformes</span><span class="op">)</span></span></code></pre></div>
<p>To save time, simply run the line below rather than the chunk
above.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">siluriformes</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/print_coverage.html">print_coverage</a></span><span class="op">(</span><span class="va">siluriformes</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##                                                                                          traits</span></span>
<span><span class="co">## pectoral fin                                                                       pectoral fin</span></span>
<span><span class="co">## pectoral fin skeleton                                                     pectoral fin skeleton</span></span>
<span><span class="co">## pectoral fin lepidotrichium                                         pectoral fin lepidotrichium</span></span>
<span><span class="co">## pectoral fin spine                                                           pectoral fin spine</span></span>
<span><span class="co">## maxillary barbel                                                               maxillary barbel</span></span>
<span><span class="co">## pelvic fin                                                                           pelvic fin</span></span>
<span><span class="co">## pelvic fin skeleton                                                         pelvic fin skeleton</span></span>
<span><span class="co">## pelvic fin lepidotrichium                                             pelvic fin lepidotrichium</span></span>
<span><span class="co">## vomer                                                                                     vomer</span></span>
<span><span class="co">## entopterygoid                                                                     entopterygoid</span></span>
<span><span class="co">## posterior nasal barbel                                                   posterior nasal barbel</span></span>
<span><span class="co">## coronomeckelian                                                                 coronomeckelian</span></span>
<span><span class="co">## mental barbel                                                                     mental barbel</span></span>
<span><span class="co">## urohyal                                                                                 urohyal</span></span>
<span><span class="co">## pectoral fin radial bone                                               pectoral fin radial bone</span></span>
<span><span class="co">## pectoral fin radial cartilage                                     pectoral fin radial cartilage</span></span>
<span><span class="co">## pectoral fin radial element                                         pectoral fin radial element</span></span>
<span><span class="co">## pectoral fin radial skeleton                                       pectoral fin radial skeleton</span></span>
<span><span class="co">## interopercle                                                                       interopercle</span></span>
<span><span class="co">## outer mental barbel                                                         outer mental barbel</span></span>
<span><span class="co">## inner mental barbel                                                         inner mental barbel</span></span>
<span><span class="co">## pelvic fin ray                                                                   pelvic fin ray</span></span>
<span><span class="co">## pelvic fin ray 1                                                               pelvic fin ray 1</span></span>
<span><span class="co">## urohyal lateral process                                                 urohyal lateral process</span></span>
<span><span class="co">## lateropterygium                                                                 lateropterygium</span></span>
<span><span class="co">## infraorbital 4                                                                   infraorbital 4</span></span>
<span><span class="co">## ectopterygoid bone                                                           ectopterygoid bone</span></span>
<span><span class="co">## accessory vomerine tooth plate                                   accessory vomerine tooth plate</span></span>
<span><span class="co">## pelvic splint                                                                     pelvic splint</span></span>
<span><span class="co">## urohyal median process                                                   urohyal median process</span></span>
<span><span class="co">## rostral plate                                                                     rostral plate</span></span>
<span><span class="co">## pectoral fin proximal radial bone                             pectoral fin proximal radial bone</span></span>
<span><span class="co">## pectoral fin proximal radial cartilage                   pectoral fin proximal radial cartilage</span></span>
<span><span class="co">## pectoral fin proximal radial element                       pectoral fin proximal radial element</span></span>
<span><span class="co">## suprapreopercle                                                                 suprapreopercle</span></span>
<span><span class="co">## pelvic fin radial bone                                                   pelvic fin radial bone</span></span>
<span><span class="co">## anterior dentation of pectoral fin spine               anterior dentation of pectoral fin spine</span></span>
<span><span class="co">## posterior dentation of pectoral fin spine             posterior dentation of pectoral fin spine</span></span>
<span><span class="co">## anterior nasal barbel                                                     anterior nasal barbel</span></span>
<span><span class="co">## pectoral fin ray                                                               pectoral fin ray</span></span>
<span><span class="co">## canal plate                                                                         canal plate</span></span>
<span><span class="co">## branched pectoral fin ray                                             branched pectoral fin ray</span></span>
<span><span class="co">## pelvic fin ray 6                                                               pelvic fin ray 6</span></span>
<span><span class="co">## pectoral fin distal radial bone                                 pectoral fin distal radial bone</span></span>
<span><span class="co">## pectoral fin distal radial cartilage                       pectoral fin distal radial cartilage</span></span>
<span><span class="co">## pectoral fin distal radial element                           pectoral fin distal radial element</span></span>
<span><span class="co">## pectoral fin proximal radial bone 1                         pectoral fin proximal radial bone 1</span></span>
<span><span class="co">## pectoral fin proximal radial bone 2                         pectoral fin proximal radial bone 2</span></span>
<span><span class="co">## pectoral fin proximal radial cartilage 1               pectoral fin proximal radial cartilage 1</span></span>
<span><span class="co">## pectoral fin proximal radial cartilage 2               pectoral fin proximal radial cartilage 2</span></span>
<span><span class="co">## pectoral fin proximal radial element 1                   pectoral fin proximal radial element 1</span></span>
<span><span class="co">## pectoral fin proximal radial element 2                   pectoral fin proximal radial element 2</span></span>
<span><span class="co">## pectoral fin distal radial bone 2                             pectoral fin distal radial bone 2</span></span>
<span><span class="co">## pectoral fin distal radial bone 3                             pectoral fin distal radial bone 3</span></span>
<span><span class="co">## pectoral fin distal radial cartilage 2                   pectoral fin distal radial cartilage 2</span></span>
<span><span class="co">## pectoral fin distal radial cartilage 3                   pectoral fin distal radial cartilage 3</span></span>
<span><span class="co">## pectoral fin distal radial element 2                       pectoral fin distal radial element 2</span></span>
<span><span class="co">## pectoral fin distal radial element 3                       pectoral fin distal radial element 3</span></span>
<span><span class="co">## antorbital                                                                           antorbital</span></span>
<span><span class="co">## pectoral fin proximal radial bone 3                         pectoral fin proximal radial bone 3</span></span>
<span><span class="co">## pectoral fin proximal radial cartilage 3               pectoral fin proximal radial cartilage 3</span></span>
<span><span class="co">## pectoral fin proximal radial element 3                   pectoral fin proximal radial element 3</span></span>
<span><span class="co">## pectoral fin ray 1                                                           pectoral fin ray 1</span></span>
<span><span class="co">## palatine bone                                                                     palatine bone</span></span>
<span><span class="co">## preopercle horizontal limb                                           preopercle horizontal limb</span></span>
<span><span class="co">## anterior distal serration of pectoral fin spine anterior distal serration of pectoral fin spine</span></span>
<span><span class="co">## pelvic fin radial element                                             pelvic fin radial element</span></span>
<span><span class="co">## pelvic fin radial skeleton                                           pelvic fin radial skeleton</span></span>
<span><span class="co">## pelvic radial cartilage                                                 pelvic radial cartilage</span></span>
<span><span class="co">##                                                 coverage     average</span></span>
<span><span class="co">## pectoral fin                                        1114 0.996409336</span></span>
<span><span class="co">## pectoral fin skeleton                               1114 0.996409336</span></span>
<span><span class="co">## pectoral fin lepidotrichium                         1073 0.996272134</span></span>
<span><span class="co">## pectoral fin spine                                  1064 0.996240602</span></span>
<span><span class="co">## maxillary barbel                                    1027 0.998886414</span></span>
<span><span class="co">## pelvic fin                                           993 0.986788618</span></span>
<span><span class="co">## pelvic fin skeleton                                  993 0.986788618</span></span>
<span><span class="co">## pelvic fin lepidotrichium                            949 0.979915433</span></span>
<span><span class="co">## vomer                                                828 0.924598269</span></span>
<span><span class="co">## entopterygoid                                        796 0.936446174</span></span>
<span><span class="co">## posterior nasal barbel                               788 0.591152815</span></span>
<span><span class="co">## coronomeckelian                                      750 0.936608558</span></span>
<span><span class="co">## mental barbel                                        748 0.827445652</span></span>
<span><span class="co">## urohyal                                              708 0.987270156</span></span>
<span><span class="co">## pectoral fin radial bone                             704 0.994318182</span></span>
<span><span class="co">## pectoral fin radial cartilage                        704 0.994318182</span></span>
<span><span class="co">## pectoral fin radial element                          704 0.994318182</span></span>
<span><span class="co">## pectoral fin radial skeleton                         704 0.994318182</span></span>
<span><span class="co">## interopercle                                         682 0.998502994</span></span>
<span><span class="co">## outer mental barbel                                  677 0.754098361</span></span>
<span><span class="co">## inner mental barbel                                  622 0.717990276</span></span>
<span><span class="co">## pelvic fin ray                                       583 0.967241379</span></span>
<span><span class="co">## pelvic fin ray 1                                     581 0.967128028</span></span>
<span><span class="co">## urohyal lateral process                              563 0.899821109</span></span>
<span><span class="co">## lateropterygium                                      536 0.941619586</span></span>
<span><span class="co">## infraorbital 4                                       501 0.990000000</span></span>
<span><span class="co">## ectopterygoid bone                                   435 0.647754137</span></span>
<span><span class="co">## accessory vomerine tooth plate                       412 0.207823961</span></span>
<span><span class="co">## pelvic splint                                        399 0.478149100</span></span>
<span><span class="co">## urohyal median process                               369 0.839673913</span></span>
<span><span class="co">## rostral plate                                        355 0.005633803</span></span>
<span><span class="co">## pectoral fin proximal radial bone                    314 0.987261146</span></span>
<span><span class="co">## pectoral fin proximal radial cartilage               314 0.987261146</span></span>
<span><span class="co">## pectoral fin proximal radial element                 314 0.987261146</span></span>
<span><span class="co">## suprapreopercle                                      309 0.770370370</span></span>
<span><span class="co">## pelvic fin radial bone                               304 0.009868421</span></span>
<span><span class="co">## anterior dentation of pectoral fin spine             289 0.691244240</span></span>
<span><span class="co">## posterior dentation of pectoral fin spine            284 0.867187500</span></span>
<span><span class="co">## anterior nasal barbel                                224 0.022321429</span></span>
<span><span class="co">## pectoral fin ray                                     172 0.976744186</span></span>
<span><span class="co">## canal plate                                          132 0.901515152</span></span>
<span><span class="co">## branched pectoral fin ray                            108 0.962962963</span></span>
<span><span class="co">## pelvic fin ray 6                                      98 0.775510204</span></span>
<span><span class="co">## pectoral fin distal radial bone                       81 0.950617284</span></span>
<span><span class="co">## pectoral fin distal radial cartilage                  81 0.950617284</span></span>
<span><span class="co">## pectoral fin distal radial element                    81 0.950617284</span></span>
<span><span class="co">## pectoral fin proximal radial bone 1                   81 0.950617284</span></span>
<span><span class="co">## pectoral fin proximal radial bone 2                   81 0.950617284</span></span>
<span><span class="co">## pectoral fin proximal radial cartilage 1              81 0.950617284</span></span>
<span><span class="co">## pectoral fin proximal radial cartilage 2              81 0.950617284</span></span>
<span><span class="co">## pectoral fin proximal radial element 1                81 0.950617284</span></span>
<span><span class="co">## pectoral fin proximal radial element 2                81 0.950617284</span></span>
<span><span class="co">## pectoral fin distal radial bone 2                     80 0.950000000</span></span>
<span><span class="co">## pectoral fin distal radial bone 3                     80 0.950000000</span></span>
<span><span class="co">## pectoral fin distal radial cartilage 2                80 0.950000000</span></span>
<span><span class="co">## pectoral fin distal radial cartilage 3                80 0.950000000</span></span>
<span><span class="co">## pectoral fin distal radial element 2                  80 0.950000000</span></span>
<span><span class="co">## pectoral fin distal radial element 3                  80 0.950000000</span></span>
<span><span class="co">## antorbital                                            78 0.974358974</span></span>
<span><span class="co">## pectoral fin proximal radial bone 3                   71 0.943661972</span></span>
<span><span class="co">## pectoral fin proximal radial cartilage 3              71 0.943661972</span></span>
<span><span class="co">## pectoral fin proximal radial element 3                71 0.943661972</span></span>
<span><span class="co">## pectoral fin ray 1                                    68 0.941176471</span></span>
<span><span class="co">## palatine bone                                         66 0.787878788</span></span>
<span><span class="co">## preopercle horizontal limb                            34 0.625000000</span></span>
<span><span class="co">## anterior distal serration of pectoral fin spine       26 0.809523810</span></span>
<span><span class="co">## pelvic fin radial element                             25 0.120000000</span></span>
<span><span class="co">## pelvic fin radial skeleton                            25 0.120000000</span></span>
<span><span class="co">## pelvic radial cartilage                               25 0.120000000</span></span></code></pre>
<p>The table that prints out shows the number of taxa for which there is
data in the KB ( <em>coverage</em> ) and the proportion of taxa (
<em>average</em> ) that have this trait present (all of these are
binary, presence/absence characters).</p>
<p>This dataset is too big for our demonstration purposes. So let’s
filter down to a smaller set of traits that will illustrate our
process.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">siluriformes</span>,<span class="st">"taxa"</span>, </span>
<span>              <span class="st">"vomer"</span>, <span class="st">"accessory vomerine tooth plate"</span>, <span class="st">"ectopterygoid bone"</span>,</span>
<span>              <span class="st">"mental barbel"</span>, <span class="st">"inner mental barbel"</span>, <span class="st">"outer mental barbel"</span>, <span class="st">"anterior nasal barbel"</span>, <span class="st">"posterior nasal barbel"</span>,</span>
<span>              <span class="st">"urohyal"</span>, <span class="st">"urohyal lateral process"</span>, <span class="st">"urohyal median process"</span>,</span>
<span>              <span class="st">"pectoral fin spine"</span>, <span class="st">"anterior dentation of pectoral fin spine"</span>, <span class="st">"posterior dentation of pectoral fin spine"</span>, </span>
<span>              <span class="st">"pectoral fin"</span>,</span>
<span>              <span class="st">"pelvic fin"</span>, <span class="st">"pelvic splint"</span>, <span class="st">"pelvic fin ray"</span></span>
<span>              <span class="op">)</span></span>
<span></span>
<span><span class="co">## Let's also clean up some of the species names to only include Genus and species (drop subspecies etc.)</span></span>
<span><span class="va">dat</span><span class="op">$</span><span class="va">taxa</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unname.html" class="external-link">unname</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">dat</span><span class="op">$</span><span class="va">taxa</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/strsplit.html" class="external-link">strsplit</a></span><span class="op">(</span><span class="va">x</span>, split<span class="op">=</span><span class="st">" "</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span>, collapse<span class="op">=</span><span class="st">"_"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##                            taxa   vomer accessory vomerine tooth plate</span></span>
<span><span class="co">## 1            Acanthicus_hystrix 1 and 0                           &lt;NA&gt;</span></span>
<span><span class="co">## 2     Acanthobunocephalus_nicoi       0                           &lt;NA&gt;</span></span>
<span><span class="co">## 3      Acanthocleithron_chapini    &lt;NA&gt;                           &lt;NA&gt;</span></span>
<span><span class="co">## 4        Acentronichthys_leptos       1                           &lt;NA&gt;</span></span>
<span><span class="co">## 5           Acentronichthys_sp.       1                           &lt;NA&gt;</span></span>
<span><span class="co">## 6 Acrochordonichthys_ischnosoma       1                           &lt;NA&gt;</span></span>
<span><span class="co">##   ectopterygoid bone mental barbel inner mental barbel outer mental barbel</span></span>
<span><span class="co">## 1               &lt;NA&gt;       0 and 1                   0                   0</span></span>
<span><span class="co">## 2               &lt;NA&gt;             1                &lt;NA&gt;                &lt;NA&gt;</span></span>
<span><span class="co">## 3               &lt;NA&gt;             1                   1                   1</span></span>
<span><span class="co">## 4                  0          &lt;NA&gt;                &lt;NA&gt;                &lt;NA&gt;</span></span>
<span><span class="co">## 5                  0          &lt;NA&gt;                &lt;NA&gt;                &lt;NA&gt;</span></span>
<span><span class="co">## 6                  1          &lt;NA&gt;                &lt;NA&gt;                &lt;NA&gt;</span></span>
<span><span class="co">##   anterior nasal barbel posterior nasal barbel urohyal urohyal lateral process</span></span>
<span><span class="co">## 1                     0                      0       1                    &lt;NA&gt;</span></span>
<span><span class="co">## 2                    NA                   &lt;NA&gt;       1                    &lt;NA&gt;</span></span>
<span><span class="co">## 3                    NA                   &lt;NA&gt;       1                    &lt;NA&gt;</span></span>
<span><span class="co">## 4                    NA                      0    &lt;NA&gt;                    &lt;NA&gt;</span></span>
<span><span class="co">## 5                    NA                      0    &lt;NA&gt;                    &lt;NA&gt;</span></span>
<span><span class="co">## 6                    NA                   &lt;NA&gt;       1                    &lt;NA&gt;</span></span>
<span><span class="co">##   urohyal median process pectoral fin spine</span></span>
<span><span class="co">## 1                   &lt;NA&gt;                  1</span></span>
<span><span class="co">## 2                   &lt;NA&gt;                  1</span></span>
<span><span class="co">## 3                   &lt;NA&gt;                  1</span></span>
<span><span class="co">## 4                   &lt;NA&gt;                  1</span></span>
<span><span class="co">## 5                   &lt;NA&gt;                  1</span></span>
<span><span class="co">## 6                   &lt;NA&gt;                  1</span></span>
<span><span class="co">##   anterior dentation of pectoral fin spine</span></span>
<span><span class="co">## 1                                  1 and 0</span></span>
<span><span class="co">## 2                                        1</span></span>
<span><span class="co">## 3                                     &lt;NA&gt;</span></span>
<span><span class="co">## 4                                     &lt;NA&gt;</span></span>
<span><span class="co">## 5                                        1</span></span>
<span><span class="co">## 6                                     &lt;NA&gt;</span></span>
<span><span class="co">##   posterior dentation of pectoral fin spine pectoral fin pelvic fin</span></span>
<span><span class="co">## 1                                      &lt;NA&gt;            1          1</span></span>
<span><span class="co">## 2                                      &lt;NA&gt;            1       &lt;NA&gt;</span></span>
<span><span class="co">## 3                                         1            1          1</span></span>
<span><span class="co">## 4                                      &lt;NA&gt;            1          1</span></span>
<span><span class="co">## 5                                   0 and 1            1          1</span></span>
<span><span class="co">## 6                                      &lt;NA&gt;            1       &lt;NA&gt;</span></span>
<span><span class="co">##   pelvic splint pelvic fin ray</span></span>
<span><span class="co">## 1          &lt;NA&gt;              1</span></span>
<span><span class="co">## 2          &lt;NA&gt;           &lt;NA&gt;</span></span>
<span><span class="co">## 3             0           &lt;NA&gt;</span></span>
<span><span class="co">## 4          &lt;NA&gt;              1</span></span>
<span><span class="co">## 5          &lt;NA&gt;              1</span></span>
<span><span class="co">## 6          &lt;NA&gt;           &lt;NA&gt;</span></span></code></pre>
<p>Now let’s load in the Rabosky fish phylogeny and match it to the data
using <code>treeplyr</code>.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">fishtree</span><span class="op">)</span></span>
<span><span class="va">td</span> <span class="op">&lt;-</span> <span class="fu">make.treedata</span><span class="op">(</span><span class="va">fishtree</span>, <span class="va">dat</span><span class="op">)</span></span>
<span><span class="va">td</span></span></code></pre></div>
<pre><code><span><span class="co">## $phy </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Phylogenetic tree with 474 tips and 473 internal nodes.</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Tip labels:</span></span>
<span><span class="co">##   Synodontis_victoriae, Synodontis_acanthomias, Synodontis_zambezensis, Synodontis_njassae, Synodontis_sorex, Synodontis_clarias, ...</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Rooted; includes branch lengths.</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $dat </span></span>
<span><span class="co">## <span style="color: #949494;"># A tibble: 474 × 18</span></span></span>
<span><span class="co">##    vomer `accessory vomerine…` `ectopterygoid…` `mental barbel` `inner mental …`</span></span>
<span><span class="co">##    <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>                 <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>           </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span> <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>                    <span style="color: #BB0000;">NA</span>               1               1               </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span> <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>                    <span style="color: #BB0000;">NA</span>               1               1               </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span> <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>                    <span style="color: #BB0000;">NA</span>               1               1               </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span> <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>                    <span style="color: #BB0000;">NA</span>               1               1               </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span> <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>                    <span style="color: #BB0000;">NA</span>               1               1               </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span> 1     0                     <span style="color: #BB0000;">NA</span>               1               1               </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span> <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>                    <span style="color: #BB0000;">NA</span>               1               1               </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span> <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>                    <span style="color: #BB0000;">NA</span>               1               1               </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span> <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>                    <span style="color: #BB0000;">NA</span>               1               1               </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span> <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>                    <span style="color: #BB0000;">NA</span>               1               1               </span></span>
<span><span class="co">## <span style="color: #949494;"># … with 464 more rows, and 13 more variables: `outer mental barbel` &lt;fct&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   `anterior nasal barbel` &lt;int&gt;, `posterior nasal barbel` &lt;fct&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   urohyal &lt;fct&gt;, `urohyal lateral process` &lt;fct&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   `urohyal median process` &lt;fct&gt;, `pectoral fin spine` &lt;int&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   `anterior dentation of pectoral fin spine` &lt;fct&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   `posterior dentation of pectoral fin spine` &lt;fct&gt;, `pectoral fin` &lt;int&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   `pelvic fin` &lt;fct&gt;, `pelvic splint` &lt;fct&gt;, `pelvic fin ray` &lt;fct&gt;</span></span></span></code></pre>
<p>We want to learn about these traits, so we’re going to build a nice
data table to see what these traits are and their unique identifiers
using the KB API and <code>rphenoscape</code> function
<code>pk_anatomical_detail</code>.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">traits</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">td</span><span class="op">$</span><span class="va">dat</span><span class="op">)</span></span>
<span><span class="va">anatomical_details</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">traits</span>, <span class="va">pk_anatomical_detail</span><span class="op">)</span> <span class="co"># Query over traits and get anatomical details </span></span></code></pre></div>
<pre><code><span><span class="co">## Warning: 'FUN' is deprecated.</span></span>
<span><span class="co">## Use 'anatomy_term_info' instead.</span></span>
<span><span class="co">## See help("Deprecated")</span></span>
<span></span>
<span><span class="co">## Warning: 'FUN' is deprecated.</span></span>
<span><span class="co">## Use 'anatomy_term_info' instead.</span></span>
<span><span class="co">## See help("Deprecated")</span></span>
<span></span>
<span><span class="co">## Warning: 'FUN' is deprecated.</span></span>
<span><span class="co">## Use 'anatomy_term_info' instead.</span></span>
<span><span class="co">## See help("Deprecated")</span></span>
<span></span>
<span><span class="co">## Warning: 'FUN' is deprecated.</span></span>
<span><span class="co">## Use 'anatomy_term_info' instead.</span></span>
<span><span class="co">## See help("Deprecated")</span></span>
<span></span>
<span><span class="co">## Warning: 'FUN' is deprecated.</span></span>
<span><span class="co">## Use 'anatomy_term_info' instead.</span></span>
<span><span class="co">## See help("Deprecated")</span></span>
<span></span>
<span><span class="co">## Warning: 'FUN' is deprecated.</span></span>
<span><span class="co">## Use 'anatomy_term_info' instead.</span></span>
<span><span class="co">## See help("Deprecated")</span></span>
<span></span>
<span><span class="co">## Warning: 'FUN' is deprecated.</span></span>
<span><span class="co">## Use 'anatomy_term_info' instead.</span></span>
<span><span class="co">## See help("Deprecated")</span></span>
<span></span>
<span><span class="co">## Warning: 'FUN' is deprecated.</span></span>
<span><span class="co">## Use 'anatomy_term_info' instead.</span></span>
<span><span class="co">## See help("Deprecated")</span></span>
<span></span>
<span><span class="co">## Warning: 'FUN' is deprecated.</span></span>
<span><span class="co">## Use 'anatomy_term_info' instead.</span></span>
<span><span class="co">## See help("Deprecated")</span></span>
<span></span>
<span><span class="co">## Warning: 'FUN' is deprecated.</span></span>
<span><span class="co">## Use 'anatomy_term_info' instead.</span></span>
<span><span class="co">## See help("Deprecated")</span></span>
<span></span>
<span><span class="co">## Warning: 'FUN' is deprecated.</span></span>
<span><span class="co">## Use 'anatomy_term_info' instead.</span></span>
<span><span class="co">## See help("Deprecated")</span></span>
<span></span>
<span><span class="co">## Warning: 'FUN' is deprecated.</span></span>
<span><span class="co">## Use 'anatomy_term_info' instead.</span></span>
<span><span class="co">## See help("Deprecated")</span></span>
<span></span>
<span><span class="co">## Warning: 'FUN' is deprecated.</span></span>
<span><span class="co">## Use 'anatomy_term_info' instead.</span></span>
<span><span class="co">## See help("Deprecated")</span></span>
<span></span>
<span><span class="co">## Warning: 'FUN' is deprecated.</span></span>
<span><span class="co">## Use 'anatomy_term_info' instead.</span></span>
<span><span class="co">## See help("Deprecated")</span></span>
<span></span>
<span><span class="co">## Warning: 'FUN' is deprecated.</span></span>
<span><span class="co">## Use 'anatomy_term_info' instead.</span></span>
<span><span class="co">## See help("Deprecated")</span></span>
<span></span>
<span><span class="co">## Warning: 'FUN' is deprecated.</span></span>
<span><span class="co">## Use 'anatomy_term_info' instead.</span></span>
<span><span class="co">## See help("Deprecated")</span></span>
<span></span>
<span><span class="co">## Warning: 'FUN' is deprecated.</span></span>
<span><span class="co">## Use 'anatomy_term_info' instead.</span></span>
<span><span class="co">## See help("Deprecated")</span></span>
<span></span>
<span><span class="co">## Warning: 'FUN' is deprecated.</span></span>
<span><span class="co">## Use 'anatomy_term_info' instead.</span></span>
<span><span class="co">## See help("Deprecated")</span></span></code></pre>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">char_info</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">char_info</span><span class="op">$</span><span class="va">ID</span> <span class="op">&lt;-</span> <span class="va">traits</span></span>
<span><span class="va">char_info</span><span class="op">$</span><span class="va">definition</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">anatomical_details</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">$</span><span class="va">definition</span><span class="op">)</span> <span class="co"># Extract definitions</span></span>
<span><span class="va">char_info</span><span class="op">$</span><span class="va">STATE_0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">traits</span><span class="op">)</span><span class="op">)</span> <span class="co"># All ontotrace matrices are binary presence/absence</span></span>
<span><span class="va">char_info</span><span class="op">$</span><span class="va">STATE_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">traits</span><span class="op">)</span><span class="op">)</span> <span class="co"># All ontotrace matrices are binary presence/absence</span></span>
<span><span class="va">char_info</span><span class="op">$</span><span class="va">IRI</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">anatomical_details</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">$</span><span class="va">id</span><span class="op">)</span> <span class="co"># Extra a unique URL identifier called an "IRI" </span></span>
<span><span class="va">char_info</span><span class="op">$</span><span class="va">IRI</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"http://purl.obolibrary.org/obo/"</span>, <span class="st">""</span>, <span class="va">char_info</span><span class="op">$</span><span class="va">IRI</span><span class="op">)</span></span>
<span><span class="va">char_info</span><span class="op">$</span><span class="va">IRI</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"_"</span>, <span class="st">":"</span>, <span class="va">char_info</span><span class="op">$</span><span class="va">IRI</span><span class="op">)</span></span>
<span></span>
<span><span class="va">char_info</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">char_info</span><span class="op">)</span></span>
<span><span class="fu">as_tibble</span><span class="op">(</span><span class="va">char_info</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 18 × 5</span></span></span>
<span><span class="co">##    ID                                        definition    STATE_0 STATE_1 IRI  </span></span>
<span><span class="co">##    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                                     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span> vomer                                     The triangul…       0       1 UBER…</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span> accessory vomerine tooth plate            Dermal bone …       0       1 UBER…</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span> ectopterygoid bone                        A palatal bo…       0       1 UBER…</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span> mental barbel                             Barbel that …       0       1 UBER…</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span> inner mental barbel                       Mental barbe…       0       1 UBER…</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span> outer mental barbel                       Mental barbe…       0       1 UBER…</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span> anterior nasal barbel                     Barbel that …       0       1 UBER…</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span> posterior nasal barbel                    Barbel that …       0       1 UBER…</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span> urohyal                                   Tendon bone …       0       1 UBER…</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span> urohyal lateral process                   Process that…       0       1 UBER…</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">11</span> urohyal median process                    Process that…       0       1 UBER…</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">12</span> pectoral fin spine                        Pectoral-fin…       0       1 UBER…</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">13</span> anterior dentation of pectoral fin spine  Process that…       0       1 UBER…</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">14</span> posterior dentation of pectoral fin spine Process that…       0       1 UBER…</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">15</span> pectoral fin                              Paired fin t…       0       1 UBER…</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">16</span> pelvic fin                                Paired fin l…       0       1 UBER…</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">17</span> pelvic splint                             Dermal bone …       0       1 UBER…</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">18</span> pelvic fin ray                            Soft ray tha…       0       1 UBER…</span></span></code></pre>
<p>We can construct a heat map that is organized by the semantic
similarity of the traits to visualize our dataset. The phylogeny is
displayed on the left side, and a tree of traits is on the top.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">njt</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/makeTraitTree.html">makeTraitTree</a></span><span class="op">(</span><span class="va">td</span>, skip<span class="op">=</span><span class="cn">NULL</span><span class="op">)</span></span>
<span><span class="va">njt</span> <span class="op">&lt;-</span> <span class="fu">root</span><span class="op">(</span><span class="fu">multi2di</span><span class="op">(</span><span class="va">njt</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">"barbel"</span>, <span class="va">njt</span><span class="op">$</span><span class="va">tip.label</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/ontologyHeatMap.html">ontologyHeatMap</a></span><span class="op">(</span><span class="va">td</span>, <span class="va">njt</span>, start<span class="op">=</span><span class="fl">1</span>, cex<span class="op">=</span><span class="fl">0.25</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning in recode.numeric(td$dat[[x]], `0 and 1` = 0.5, `1 and 0` = 0.5, : NAs</span></span>
<span><span class="co">## introduced by coercion</span></span>
<span></span>
<span><span class="co">## Warning in recode.numeric(td$dat[[x]], `0 and 1` = 0.5, `1 and 0` = 0.5, : NAs</span></span>
<span><span class="co">## introduced by coercion</span></span>
<span></span>
<span><span class="co">## Warning in recode.numeric(td$dat[[x]], `0 and 1` = 0.5, `1 and 0` = 0.5, : NAs</span></span>
<span><span class="co">## introduced by coercion</span></span></code></pre>
<pre><code><span><span class="co">## ***************************************************************</span></span>
<span><span class="co">## *                          Note:                              *</span></span>
<span><span class="co">## *    force.ultrametric does not include a formal method to    *</span></span>
<span><span class="co">## *    ultrametricize a tree &amp; should only be used to coerce    *</span></span>
<span><span class="co">## *   a phylogeny that fails is.ultramtric due to rounding --   *</span></span>
<span><span class="co">## *    not as a substitute for formal rate-smoothing methods.   *</span></span>
<span><span class="co">## ***************************************************************</span></span></code></pre>
<p><img src="PARAMO_files/figure-html/unnamed-chunk-7-1.png" width="700"></p>
<pre><code><span><span class="co">## NULL</span></span></code></pre>
<p>Some of our taxa are really data poor, so let’s filter them out and
deal with a smaller, more manageable dataset by excluding all taxa that
don’t have at least 40% of the traits as data.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tdf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/filter_coverage.html">filter_coverage</a></span><span class="op">(</span><span class="va">td</span>, traits<span class="op">=</span><span class="fl">0</span>, taxa<span class="op">=</span><span class="fl">0.4</span><span class="op">)</span></span>
<span><span class="va">njt</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/makeTraitTree.html">makeTraitTree</a></span><span class="op">(</span><span class="va">tdf</span>, skip<span class="op">=</span><span class="cn">NULL</span><span class="op">)</span></span>
<span><span class="va">njt</span> <span class="op">&lt;-</span> <span class="fu">root.phylo</span><span class="op">(</span><span class="va">njt</span>, <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">"barbel"</span>, <span class="va">njt</span><span class="op">$</span><span class="va">tip.label</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/ontologyHeatMap.html">ontologyHeatMap</a></span><span class="op">(</span><span class="va">tdf</span>, <span class="va">njt</span>, start<span class="op">=</span><span class="fl">1</span>, cex<span class="op">=</span><span class="fl">0.25</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning in recode.numeric(td$dat[[x]], `0 and 1` = 0.5, `1 and 0` = 0.5, : NAs</span></span>
<span><span class="co">## introduced by coercion</span></span>
<span></span>
<span><span class="co">## Warning in recode.numeric(td$dat[[x]], `0 and 1` = 0.5, `1 and 0` = 0.5, : NAs</span></span>
<span><span class="co">## introduced by coercion</span></span>
<span></span>
<span><span class="co">## Warning in recode.numeric(td$dat[[x]], `0 and 1` = 0.5, `1 and 0` = 0.5, : NAs</span></span>
<span><span class="co">## introduced by coercion</span></span></code></pre>
<pre><code><span><span class="co">## ***************************************************************</span></span>
<span><span class="co">## *                          Note:                              *</span></span>
<span><span class="co">## *    force.ultrametric does not include a formal method to    *</span></span>
<span><span class="co">## *    ultrametricize a tree &amp; should only be used to coerce    *</span></span>
<span><span class="co">## *   a phylogeny that fails is.ultramtric due to rounding --   *</span></span>
<span><span class="co">## *    not as a substitute for formal rate-smoothing methods.   *</span></span>
<span><span class="co">## ***************************************************************</span></span></code></pre>
<p><img src="PARAMO_files/figure-html/unnamed-chunk-8-1.png" width="700"></p>
<pre><code><span><span class="co">## NULL</span></span></code></pre>
<p>Next, we want to identify the dependencies in our traits by using
<code><a href="http://rphenoscape.phenoscape.org/reference/pa_dep_matrix.html" class="external-link">rphenoscape::pa_dep_matrix</a></code>, which returns a
presence-absence dependency matrix when provided a list of terms. In
other words, it returns which traits depend on the presence of another
trait. This will be key information for building our evolutionary
models, as not considering it can result in impossible ancestral state
reconstructions and can also help the pseudoreplication that occurs when
considering non-independent characters in phylogenetic analyses.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dep.mat</span> <span class="op">&lt;-</span> <span class="fu"><a href="http://rphenoscape.phenoscape.org/reference/pa_dep_matrix.html" class="external-link">pa_dep_matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"N:"</span>, <span class="st">"N_"</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"http://purl.obolibrary.org/obo/"</span>, <span class="va">char_info</span><span class="op">$</span><span class="va">IRI</span>, sep<span class="op">=</span><span class="st">""</span><span class="op">)</span><span class="op">)</span>, .names<span class="op">=</span><span class="st">"label"</span>, preserveOrder<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">dep.mat</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span>
<span><span class="va">G1</span> <span class="op">&lt;-</span> <span class="fu">igraph</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/igraph/man/graph_from_adjacency_matrix.html" class="external-link">graph_from_adjacency_matrix</a></span><span class="op">(</span><span class="fu"><a href="../reference/remove_indirect.html">remove_indirect</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">dep.mat</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">con.comp</span> <span class="op">&lt;-</span> <span class="fu">igraph</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/igraph/man/components.html" class="external-link">components</a></span><span class="op">(</span><span class="va">G1</span>, <span class="st">"weak"</span><span class="op">)</span> <span class="co"># Organizes the subgraphs within our graph and allows us to pick out connected pieces</span></span>
<span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">G1</span>, vertex.size<span class="op">=</span><span class="fl">5</span>, edge.arrow.size<span class="op">=</span><span class="fl">0.5</span>, vertex.label.cex<span class="op">=</span><span class="fl">0.75</span><span class="op">)</span></span></code></pre></div>
<p><img src="PARAMO_files/figure-html/unnamed-chunk-9-1.png" width="700"></p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pf.group</span> <span class="op">&lt;-</span> <span class="va">con.comp</span><span class="op">$</span><span class="va">membership</span><span class="op">[</span><span class="st">"pectoral fin"</span><span class="op">]</span> <span class="co">## Which group contains "pectoral fin"</span></span>
<span><span class="va">pf.Graph</span> <span class="op">&lt;-</span> <span class="fu">igraph</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/igraph/man/subgraph.html" class="external-link">induced_subgraph</a></span><span class="op">(</span><span class="va">G1</span>, <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">con.comp</span><span class="op">$</span><span class="va">membership</span><span class="op">==</span><span class="va">pf.group</span><span class="op">)</span><span class="op">)</span> <span class="co">## Pick out the subgraph with "pectoral fin"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">pf.Graph</span>, vertex.label.cex<span class="op">=</span><span class="fl">0.75</span><span class="op">)</span></span></code></pre></div>
<p><img src="PARAMO_files/figure-html/unnamed-chunk-9-2.png" width="700">
In the dependency graph above, for example, you can see that the
presence of the pectoral fin spine is dependent on the presence of the
pectoral fin.</p>
<p>Now we can build in our dependencies into our evolutionary models by
amalgamating characters based on their dependency structure (pulled from
the graph).</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">amal.deps</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/amalgamate_deps.html">amalgamate_deps</a></span><span class="op">(</span><span class="va">dep.mat</span><span class="op">)</span> <span class="co">## Create an object of transition matrices for the amalgamated characters</span></span>
<span><span class="va">td.comb</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/recode_traits.html">recode_traits</a></span><span class="op">(</span><span class="va">tdf</span>, <span class="va">amal.deps</span><span class="op">)</span> <span class="co">## Recode the original dataset according to the character states of the new, amalgamated characters (with Hidden states)</span></span></code></pre></div>
<p>If the above code didn’t work for you, you can catch up by loading
this dataset from the <code>scate-shortcourse</code> package</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">td.comb</span><span class="op">)</span></span></code></pre></div>
<p>We can reconstruct our stochastic character maps by first fitting the
model in the R package <code>corHMM</code>, then using the model fit to
generate stochastic maps in <code>phytools</code>. In the workshop, we
will do a Julia Child-style switch-a-roo and analyze completed analyses,
rather than actually running these, because they will take too long.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## WARNING: VERY TIME CONSUMING (~15-30 minutes)</span></span>
<span><span class="va">corhmm.fits</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/amalgamated_fits_corHMM.html">amalgamated_fits_corHMM</a></span><span class="op">(</span><span class="va">td.comb</span>, <span class="va">amal.deps</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">corhmm.fits</span><span class="op">)</span></span>
<span><span class="va">trees</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/amalgamated_simmaps_phytools.html">amalgamated_simmaps_phytools</a></span><span class="op">(</span><span class="va">corhmm.fits</span>, nsim<span class="op">=</span><span class="fl">2</span><span class="op">)</span> <span class="co"># Create 2 stochastic character maps per character</span></span></code></pre></div>
<pre><code><span><span class="co">## make.simmap is sampling character histories conditioned on</span></span>
<span><span class="co">## the transition matrix</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Q =</span></span>
<span><span class="co">##              0            1</span></span>
<span><span class="co">## 0 -0.015181962  0.015181962</span></span>
<span><span class="co">## 1  0.000439188 -0.000439188</span></span>
<span><span class="co">## (specified by the user);</span></span>
<span><span class="co">## and (mean) root node prior probabilities</span></span>
<span><span class="co">## pi =</span></span>
<span><span class="co">##          0          1 </span></span>
<span><span class="co">## 0.08538509 0.91461491</span></span></code></pre>
<pre><code><span><span class="co">## Done.</span></span></code></pre>
<pre><code><span><span class="co">## make.simmap is sampling character histories conditioned on</span></span>
<span><span class="co">## the transition matrix</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Q =</span></span>
<span><span class="co">##              0            1</span></span>
<span><span class="co">## 0 -0.001262416  0.001262416</span></span>
<span><span class="co">## 1  0.005320256 -0.005320256</span></span>
<span><span class="co">## (specified by the user);</span></span>
<span><span class="co">## and (mean) root node prior probabilities</span></span>
<span><span class="co">## pi =</span></span>
<span><span class="co">##          0          1 </span></span>
<span><span class="co">## 0.98917784 0.01082216</span></span></code></pre>
<pre><code><span><span class="co">## Done.</span></span></code></pre>
<pre><code><span><span class="co">## make.simmap is sampling character histories conditioned on</span></span>
<span><span class="co">## the transition matrix</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Q =</span></span>
<span><span class="co">##              0            1</span></span>
<span><span class="co">## 0 -0.005602360  0.005602360</span></span>
<span><span class="co">## 1  0.001354655 -0.001354655</span></span>
<span><span class="co">## (specified by the user);</span></span>
<span><span class="co">## and (mean) root node prior probabilities</span></span>
<span><span class="co">## pi =</span></span>
<span><span class="co">##           0           1 </span></span>
<span><span class="co">## 0.998542608 0.001457392</span></span></code></pre>
<pre><code><span><span class="co">## Done.</span></span></code></pre>
<pre><code><span><span class="co">## make.simmap is sampling character histories conditioned on</span></span>
<span><span class="co">## the transition matrix</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Q =</span></span>
<span><span class="co">##              0            1            2            3            4            5</span></span>
<span><span class="co">## 0 -0.001580976  0.000000000  0.000000000  0.000000000  0.001580976  0.000000000</span></span>
<span><span class="co">## 1  0.000000000 -0.001580976  0.000000000  0.000000000  0.000000000  0.001580976</span></span>
<span><span class="co">## 2  0.000000000  0.000000000 -0.001580976  0.000000000  0.000000000  0.000000000</span></span>
<span><span class="co">## 3  0.000000000  0.000000000  0.000000000 -0.001580976  0.000000000  0.000000000</span></span>
<span><span class="co">## 4  0.000000000  0.000000000  0.000000000  0.000000000 -0.618379378  0.323162692</span></span>
<span><span class="co">## 5  0.000000000  0.000000000  0.000000000  0.000000000  0.003743554 -0.298960240</span></span>
<span><span class="co">## 6  0.000000000  0.000000000  0.000000000  0.000000000  0.007070156  0.000000000</span></span>
<span><span class="co">## 7  0.000000000  0.000000000  0.000000000  0.000000000  0.000000000  0.007070156</span></span>
<span><span class="co">##              6            7</span></span>
<span><span class="co">## 0  0.000000000  0.000000000</span></span>
<span><span class="co">## 1  0.000000000  0.000000000</span></span>
<span><span class="co">## 2  0.001580976  0.000000000</span></span>
<span><span class="co">## 3  0.000000000  0.001580976</span></span>
<span><span class="co">## 4  0.295216686  0.000000000</span></span>
<span><span class="co">## 5  0.000000000  0.295216686</span></span>
<span><span class="co">## 6 -0.330232848  0.323162692</span></span>
<span><span class="co">## 7  0.003743554 -0.010813710</span></span>
<span><span class="co">## (specified by the user);</span></span>
<span><span class="co">## and (mean) root node prior probabilities</span></span>
<span><span class="co">## pi =</span></span>
<span><span class="co">##            0            1            2            3            4            5 </span></span>
<span><span class="co">## 1.000000e+00 7.655106e-09 1.385522e-08 1.179111e-09 2.391490e-08 5.143241e-11 </span></span>
<span><span class="co">##            6            7 </span></span>
<span><span class="co">## 9.325065e-11 1.211850e-12</span></span></code></pre>
<pre><code><span><span class="co">## Done.</span></span></code></pre>
<pre><code><span><span class="co">## make.simmap is sampling character histories conditioned on</span></span>
<span><span class="co">## the transition matrix</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Q =</span></span>
<span><span class="co">##               0            1</span></span>
<span><span class="co">## 0 -0.0007914947 0.0007914947</span></span>
<span><span class="co">## 1  0.0000000000 0.0000000000</span></span>
<span><span class="co">## (specified by the user);</span></span>
<span><span class="co">## and (mean) root node prior probabilities</span></span>
<span><span class="co">## pi =</span></span>
<span><span class="co">##            0            1 </span></span>
<span><span class="co">## 1.000000e+00 4.487579e-08</span></span></code></pre>
<pre><code><span><span class="co">## Done.</span></span></code></pre>
<pre><code><span><span class="co">## make.simmap is sampling character histories conditioned on</span></span>
<span><span class="co">## the transition matrix</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Q =</span></span>
<span><span class="co">##              0            1</span></span>
<span><span class="co">## 0 -0.005096552  0.005096552</span></span>
<span><span class="co">## 1  0.002356203 -0.002356203</span></span>
<span><span class="co">## (specified by the user);</span></span>
<span><span class="co">## and (mean) root node prior probabilities</span></span>
<span><span class="co">## pi =</span></span>
<span><span class="co">##         0         1 </span></span>
<span><span class="co">## 0.8156332 0.1843668</span></span></code></pre>
<pre><code><span><span class="co">## Done.</span></span></code></pre>
<pre><code><span><span class="co">## make.simmap is sampling character histories conditioned on</span></span>
<span><span class="co">## the transition matrix</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Q =</span></span>
<span><span class="co">##            0          1          2          3             4             5</span></span>
<span><span class="co">## 0 -0.2422633  0.0000000  0.0000000  0.0000000  0.2422632522  0.0000000000</span></span>
<span><span class="co">## 1  0.0000000 -0.2422633  0.0000000  0.0000000  0.0000000000  0.2422632522</span></span>
<span><span class="co">## 2  0.0000000  0.0000000 -0.2422633  0.0000000  0.0000000000  0.0000000000</span></span>
<span><span class="co">## 3  0.0000000  0.0000000  0.0000000 -0.2422633  0.0000000000  0.0000000000</span></span>
<span><span class="co">## 4  0.0000000  0.0000000  0.0000000  0.0000000 -0.0075404502  0.0000000000</span></span>
<span><span class="co">## 5  0.0000000  0.0000000  0.0000000  0.0000000  0.0004123124 -0.0079527625</span></span>
<span><span class="co">## 6  0.0000000  0.0000000  0.0000000  0.0000000  0.0004200246  0.0000000000</span></span>
<span><span class="co">## 7  0.0000000  0.0000000  0.0000000  0.0000000  0.0000000000  0.0004200246</span></span>
<span><span class="co">##               6            7</span></span>
<span><span class="co">## 0  0.0000000000  0.000000000</span></span>
<span><span class="co">## 1  0.0000000000  0.000000000</span></span>
<span><span class="co">## 2  0.2422632522  0.000000000</span></span>
<span><span class="co">## 3  0.0000000000  0.242263252</span></span>
<span><span class="co">## 4  0.0075404502  0.000000000</span></span>
<span><span class="co">## 5  0.0000000000  0.007540450</span></span>
<span><span class="co">## 6 -0.0004200246  0.000000000</span></span>
<span><span class="co">## 7  0.0004123124 -0.000832337</span></span>
<span><span class="co">## (specified by the user);</span></span>
<span><span class="co">## and (mean) root node prior probabilities</span></span>
<span><span class="co">## pi =</span></span>
<span><span class="co">##            0            1            2            3            4            5 </span></span>
<span><span class="co">## 6.343138e-19 6.397440e-03 3.236837e-17 4.926197e-01 4.868857e-11 1.180867e-02 </span></span>
<span><span class="co">##            6            7 </span></span>
<span><span class="co">## 2.016923e-09 4.891742e-01</span></span></code></pre>
<pre><code><span><span class="co">## Done.</span></span></code></pre>
<pre><code><span><span class="co">## make.simmap is sampling character histories conditioned on</span></span>
<span><span class="co">## the transition matrix</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Q =</span></span>
<span><span class="co">##                0             1            10            11           12</span></span>
<span><span class="co">## 0  -0.0002936557  0.0000000000  0.0000000000  0.0000000000  0.000000000</span></span>
<span><span class="co">## 1   0.0000000000 -0.0002936557  0.0000000000  0.0000000000  0.000000000</span></span>
<span><span class="co">## 10  0.0000000000  0.0000000000 -0.0002936557  0.0000000000  0.000000000</span></span>
<span><span class="co">## 11  0.0000000000  0.0000000000  0.0000000000 -0.0002936557  0.000000000</span></span>
<span><span class="co">## 12  0.0000000000  0.0000000000  0.0000000000  0.0000000000 -0.045575315</span></span>
<span><span class="co">## 13  0.0000000000  0.0000000000  0.0000000000  0.0000000000  0.000000000</span></span>
<span><span class="co">## 14  0.0000000000  0.0000000000  0.0000000000  0.0000000000  0.006548259</span></span>
<span><span class="co">## 15  0.0000000000  0.0000000000  0.0000000000  0.0000000000  0.000000000</span></span>
<span><span class="co">## 2   0.2297699449  0.0000000000  0.0000000000  0.0000000000  0.000000000</span></span>
<span><span class="co">## 3   0.0000000000  0.2297699449  0.0000000000  0.0000000000  0.000000000</span></span>
<span><span class="co">## 4   0.0000000000  0.0000000000  0.2297699449  0.0000000000  0.000000000</span></span>
<span><span class="co">## 5   0.0000000000  0.0000000000  0.0000000000  0.2297699449  0.000000000</span></span>
<span><span class="co">## 6   0.0000000000  0.0000000000  0.0000000000  0.0000000000  0.229769945</span></span>
<span><span class="co">## 7   0.0000000000  0.0000000000  0.0000000000  0.0000000000  0.000000000</span></span>
<span><span class="co">## 8   0.0000000000  0.0000000000  0.0000000000  0.0000000000  0.000000000</span></span>
<span><span class="co">## 9   0.0000000000  0.0000000000  0.0000000000  0.0000000000  0.000000000</span></span>
<span><span class="co">##              13          14           15             2             3</span></span>
<span><span class="co">## 0   0.000000000  0.00000000  0.000000000  0.0002936557  0.0000000000</span></span>
<span><span class="co">## 1   0.000000000  0.00000000  0.000000000  0.0000000000  0.0002936557</span></span>
<span><span class="co">## 10  0.000000000  0.00000000  0.000000000  0.0000000000  0.0000000000</span></span>
<span><span class="co">## 11  0.000000000  0.00000000  0.000000000  0.0000000000  0.0000000000</span></span>
<span><span class="co">## 12  0.024642662  0.02063900  0.000000000  0.0000000000  0.0000000000</span></span>
<span><span class="co">## 13 -0.020932653  0.00000000  0.020638998  0.0000000000  0.0000000000</span></span>
<span><span class="co">## 14  0.000000000 -0.03148458  0.024642662  0.0000000000  0.0000000000</span></span>
<span><span class="co">## 15  0.006548259  0.00000000 -0.006841915  0.0000000000  0.0000000000</span></span>
<span><span class="co">## 2   0.000000000  0.00000000  0.000000000 -0.7412377583  0.0000000000</span></span>
<span><span class="co">## 3   0.000000000  0.00000000  0.000000000  0.0000000000 -0.7412377583</span></span>
<span><span class="co">## 4   0.000000000  0.00000000  0.000000000  0.0000000000  0.0000000000</span></span>
<span><span class="co">## 5   0.000000000  0.00000000  0.000000000  0.0000000000  0.0000000000</span></span>
<span><span class="co">## 6   0.000000000  0.00000000  0.000000000  0.3763825953  0.0000000000</span></span>
<span><span class="co">## 7   0.229769945  0.00000000  0.000000000  0.0000000000  0.3763825953</span></span>
<span><span class="co">## 8   0.000000000  0.22976994  0.000000000  0.0000000000  0.0000000000</span></span>
<span><span class="co">## 9   0.000000000  0.00000000  0.229769945  0.0000000000  0.0000000000</span></span>
<span><span class="co">##                4             5             6             7             8</span></span>
<span><span class="co">## 0   0.0000000000  0.0000000000  0.0000000000  0.0000000000  0.0000000000</span></span>
<span><span class="co">## 1   0.0000000000  0.0000000000  0.0000000000  0.0000000000  0.0000000000</span></span>
<span><span class="co">## 10  0.0002936557  0.0000000000  0.0000000000  0.0000000000  0.0000000000</span></span>
<span><span class="co">## 11  0.0000000000  0.0002936557  0.0000000000  0.0000000000  0.0000000000</span></span>
<span><span class="co">## 12  0.0000000000  0.0000000000  0.0002936557  0.0000000000  0.0000000000</span></span>
<span><span class="co">## 13  0.0000000000  0.0000000000  0.0000000000  0.0002936557  0.0000000000</span></span>
<span><span class="co">## 14  0.0000000000  0.0000000000  0.0000000000  0.0000000000  0.0002936557</span></span>
<span><span class="co">## 15  0.0000000000  0.0000000000  0.0000000000  0.0000000000  0.0000000000</span></span>
<span><span class="co">## 2   0.0000000000  0.0000000000  0.5114678135  0.0000000000  0.0000000000</span></span>
<span><span class="co">## 3   0.0000000000  0.0000000000  0.0000000000  0.5114678135  0.0000000000</span></span>
<span><span class="co">## 4  -0.7412377583  0.0000000000  0.0000000000  0.0000000000  0.5114678135</span></span>
<span><span class="co">## 5   0.0000000000 -0.7412377583  0.0000000000  0.0000000000  0.0000000000</span></span>
<span><span class="co">## 6   0.0000000000  0.0000000000 -0.6514341999  0.0246426622  0.0206389975</span></span>
<span><span class="co">## 7   0.0000000000  0.0000000000  0.0000000000 -0.6267915377  0.0000000000</span></span>
<span><span class="co">## 8   0.3763825953  0.0000000000  0.0065482591  0.0000000000 -0.6373434615</span></span>
<span><span class="co">## 9   0.0000000000  0.3763825953  0.0000000000  0.0065482591  0.0000000000</span></span>
<span><span class="co">##                9</span></span>
<span><span class="co">## 0   0.0000000000</span></span>
<span><span class="co">## 1   0.0000000000</span></span>
<span><span class="co">## 10  0.0000000000</span></span>
<span><span class="co">## 11  0.0000000000</span></span>
<span><span class="co">## 12  0.0000000000</span></span>
<span><span class="co">## 13  0.0000000000</span></span>
<span><span class="co">## 14  0.0000000000</span></span>
<span><span class="co">## 15  0.0002936557</span></span>
<span><span class="co">## 2   0.0000000000</span></span>
<span><span class="co">## 3   0.0000000000</span></span>
<span><span class="co">## 4   0.0000000000</span></span>
<span><span class="co">## 5   0.5114678135</span></span>
<span><span class="co">## 6   0.0000000000</span></span>
<span><span class="co">## 7   0.0206389975</span></span>
<span><span class="co">## 8   0.0246426622</span></span>
<span><span class="co">## 9  -0.6127007993</span></span>
<span><span class="co">## (specified by the user);</span></span>
<span><span class="co">## and (mean) root node prior probabilities</span></span>
<span><span class="co">## pi =</span></span>
<span><span class="co">##            0            1           10           11           12           13 </span></span>
<span><span class="co">## 8.390665e-07 6.130776e-14 1.046516e-06 7.638700e-14 2.969643e-01 9.079284e-08 </span></span>
<span><span class="co">##           14           15            2            3            4            5 </span></span>
<span><span class="co">## 3.631342e-01 1.110233e-07 4.616034e-02 2.598839e-09 5.705092e-02 3.209243e-09 </span></span>
<span><span class="co">##            6            7            8            9 </span></span>
<span><span class="co">## 1.062751e-01 3.240113e-08 1.304130e-01 3.975679e-08</span></span></code></pre>
<pre><code><span><span class="co">## Done.</span></span></code></pre>
<pre><code><span><span class="co">## make.simmap is sampling character histories conditioned on</span></span>
<span><span class="co">## the transition matrix</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Q =</span></span>
<span><span class="co">##            0          1          2          3          4            5</span></span>
<span><span class="co">## 0 -0.8152564  0.0000000  0.0000000  0.0000000  0.8152564  0.000000000</span></span>
<span><span class="co">## 1  0.0000000 -0.8152564  0.0000000  0.0000000  0.0000000  0.815256398</span></span>
<span><span class="co">## 2  0.0000000  0.0000000 -0.8152564  0.0000000  0.0000000  0.000000000</span></span>
<span><span class="co">## 3  0.0000000  0.0000000  0.0000000 -0.8152564  0.0000000  0.000000000</span></span>
<span><span class="co">## 4  0.0000000  0.0000000  0.0000000  0.0000000 -3.1339064  3.127180986</span></span>
<span><span class="co">## 5  0.0000000  0.0000000  0.0000000  0.0000000  0.0000000 -0.006725387</span></span>
<span><span class="co">## 6  0.0000000  0.0000000  0.0000000  0.0000000  0.0000000  0.000000000</span></span>
<span><span class="co">## 7  0.0000000  0.0000000  0.0000000  0.0000000  0.0000000  0.000000000</span></span>
<span><span class="co">##              6           7</span></span>
<span><span class="co">## 0  0.000000000 0.000000000</span></span>
<span><span class="co">## 1  0.000000000 0.000000000</span></span>
<span><span class="co">## 2  0.815256398 0.000000000</span></span>
<span><span class="co">## 3  0.000000000 0.815256398</span></span>
<span><span class="co">## 4  0.006725387 0.000000000</span></span>
<span><span class="co">## 5  0.000000000 0.006725387</span></span>
<span><span class="co">## 6 -3.127180986 3.127180986</span></span>
<span><span class="co">## 7  0.000000000 0.000000000</span></span>
<span><span class="co">## (specified by the user);</span></span>
<span><span class="co">## and (mean) root node prior probabilities</span></span>
<span><span class="co">## pi =</span></span>
<span><span class="co">##            0            1            2            3            4            5 </span></span>
<span><span class="co">## 2.507703e-01 2.507703e-01 2.791046e-08 2.791046e-08 2.492219e-01 2.492375e-01 </span></span>
<span><span class="co">##            6            7 </span></span>
<span><span class="co">## 4.496398e-08 4.496679e-08</span></span></code></pre>
<pre><code><span><span class="co">## Done.</span></span></code></pre>
<p>We can plot these simmap trees immediately and see what it looks
like, we will do this again shortly with prettier labeling and
colors.</p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">trees</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">states</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">corhmm.fits</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">index.mat</span><span class="op">)</span></span>
<span>  <span class="fu">phytools</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/phytools/man/plotSimmap.html" class="external-link">plotSimmap</a></span><span class="op">(</span><span class="va">trees</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, ftype<span class="op">=</span><span class="st">"off"</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<pre><code><span><span class="co">## no colors provided. using the following legend:</span></span>
<span><span class="co">##         0         1 </span></span>
<span><span class="co">##   "black" "#DF536B"</span></span></code></pre>
<pre><code><span><span class="co">## no colors provided. using the following legend:</span></span>
<span><span class="co">##         0         1 </span></span>
<span><span class="co">##   "black" "#DF536B"</span></span></code></pre>
<pre><code><span><span class="co">## no colors provided. using the following legend:</span></span>
<span><span class="co">##         0         1 </span></span>
<span><span class="co">##   "black" "#DF536B"</span></span></code></pre>
<pre><code><span><span class="co">## no colors provided. using the following legend:</span></span>
<span><span class="co">##         0         4         5         6         7 </span></span>
<span><span class="co">##   "black" "#DF536B" "#61D04F" "#2297E6" "#28E2E5"</span></span></code></pre>
<pre><code><span><span class="co">## no colors provided. using the following legend:</span></span>
<span><span class="co">##         0         1 </span></span>
<span><span class="co">##   "black" "#DF536B"</span></span></code></pre>
<pre><code><span><span class="co">## no colors provided. using the following legend:</span></span>
<span><span class="co">##         0         1 </span></span>
<span><span class="co">##   "black" "#DF536B"</span></span></code></pre>
<pre><code><span><span class="co">## no colors provided. using the following legend:</span></span>
<span><span class="co">##         3         4         5         6         7 </span></span>
<span><span class="co">##   "black" "#DF536B" "#61D04F" "#2297E6" "#28E2E5"</span></span></code></pre>
<pre><code><span><span class="co">## no colors provided. using the following legend:</span></span>
<span><span class="co">##         0        12        13        14        15         2         6 </span></span>
<span><span class="co">##   "black" "#DF536B" "#61D04F" "#2297E6" "#28E2E5" "#CD0BBC" "#F5C710"</span></span></code></pre>
<pre><code><span><span class="co">## no colors provided. using the following legend:</span></span>
<span><span class="co">##         4         5         7 </span></span>
<span><span class="co">##   "black" "#DF536B" "#61D04F"</span></span></code></pre>
<p><img src="PARAMO_files/figure-html/unnamed-chunk-14-1.png" width="700"></p>
<p>Our next step is to aggregate the traits by their trait types. This
part is not quite done by the phenoscape API, so we’re going to interact
directly with the UBERON ontology. In the future, this will not be
necessary. To construct manually, you simply need to provide a list of
how you want the traits aggregated.</p>
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># let's modify our character info to drop dependent states and match our new amalgamated characters</span></span>
<span><span class="va">char_info_comb</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dropDependentTraits.html">dropDependentTraits</a></span><span class="op">(</span><span class="va">char_info</span>, <span class="va">dep.mat</span>, <span class="va">td.comb</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">UBERON</span><span class="op">)</span></span>
<span><span class="va">BR_names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"dermatocranium"</span>, <span class="st">"paired fin"</span>, <span class="st">"external integument structure"</span><span class="op">)</span></span>
<span><span class="va">EF_names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"anatomical structure"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">BR</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/RAC_query.html">RAC_query</a></span><span class="op">(</span><span class="va">char_info_comb</span>, <span class="va">UBERON</span>, <span class="va">BR_names</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning: 'FUN' is deprecated.</span></span>
<span><span class="co">## Use 'get_term_iri' instead.</span></span>
<span><span class="co">## See help("Deprecated")</span></span>
<span></span>
<span><span class="co">## Warning: 'FUN' is deprecated.</span></span>
<span><span class="co">## Use 'get_term_iri' instead.</span></span>
<span><span class="co">## See help("Deprecated")</span></span>
<span></span>
<span><span class="co">## Warning: 'FUN' is deprecated.</span></span>
<span><span class="co">## Use 'get_term_iri' instead.</span></span>
<span><span class="co">## See help("Deprecated")</span></span></code></pre>
<pre><code><span><span class="co">## Warning in parts$IRI &lt;- sapply(parts[, 1], strip_IRI): Coercing LHS to a list</span></span></code></pre>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Aggregations by :</span></span>
<span><span class="co">## $dermatocranium</span></span>
<span><span class="co">## [1] "vomer"                                                 </span></span>
<span><span class="co">## [2] "accessory vomerine tooth plate"                        </span></span>
<span><span class="co">## [3] "ectopterygoid bone"                                    </span></span>
<span><span class="co">## [4] "urohyal+urohyal lateral process+urohyal median process"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $`paired fin`</span></span>
<span><span class="co">## [1] "pectoral fin+pectoral fin spine+anterior dentation of pectoral fin spine+posterior dentation of pectoral fin spine"</span></span>
<span><span class="co">## [2] "pelvic fin+pelvic splint+pelvic fin ray"                                                                           </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $`external integument structure`</span></span>
<span><span class="co">## [1] "mental barbel+inner mental barbel+outer mental barbel"</span></span>
<span><span class="co">## [2] "anterior nasal barbel"                                </span></span>
<span><span class="co">## [3] "posterior nasal barbel"</span></span></code></pre>
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">EF</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/RAC_query.html">RAC_query</a></span><span class="op">(</span><span class="va">char_info_comb</span>, <span class="va">UBERON</span>, <span class="va">EF_names</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning: 'FUN' is deprecated.</span></span>
<span><span class="co">## Use 'get_term_iri' instead.</span></span>
<span><span class="co">## See help("Deprecated")</span></span>
<span></span>
<span><span class="co">## Warning: Coercing LHS to a list</span></span></code></pre>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Aggregations by :</span></span>
<span><span class="co">## $`anatomical structure`</span></span>
<span><span class="co">## [1] "vomer"                                                                                                             </span></span>
<span><span class="co">## [2] "accessory vomerine tooth plate"                                                                                    </span></span>
<span><span class="co">## [3] "ectopterygoid bone"                                                                                                </span></span>
<span><span class="co">## [4] "mental barbel+inner mental barbel+outer mental barbel"                                                             </span></span>
<span><span class="co">## [5] "anterior nasal barbel"                                                                                             </span></span>
<span><span class="co">## [6] "posterior nasal barbel"                                                                                            </span></span>
<span><span class="co">## [7] "urohyal+urohyal lateral process+urohyal median process"                                                            </span></span>
<span><span class="co">## [8] "pectoral fin+pectoral fin spine+anterior dentation of pectoral fin spine+posterior dentation of pectoral fin spine"</span></span>
<span><span class="co">## [9] "pelvic fin+pelvic splint+pelvic fin ray"</span></span></code></pre>
<p>This next section stacks stochastic character maps by aggregation
level, making new amalgamated super-characters. We do this at 3
levels.</p>
<div class="sourceCode" id="cb61"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#############</span></span>
<span><span class="co"># Individual characters</span></span>
<span><span class="co">#############</span></span>
<span><span class="co"># This is a function to processes the individual rayDISC maps produced by corHMM and discretizes the maps to ease amalgamation. </span></span>
<span><span class="co"># For individual characters, no additional processing is necessary</span></span>
<span><span class="va">IND.maps</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/prepareMapsRayDISC.html">prepareMapsRayDISC</a></span><span class="op">(</span><span class="va">td.comb</span>, <span class="va">trees</span>, discretization_level<span class="op">=</span><span class="fl">100</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co">#############</span></span>
<span><span class="co"># Amalgamation at the BR level</span></span>
<span><span class="co">#############</span></span>
<span><span class="co"># we use the ouput `BR` from the RAC query obtained at Step 3. </span></span>
<span><span class="co"># This ouput contains character IDs for BR terms</span></span>
<span><span class="co"># Let's rename those IDs to match the file names of the stochastic maps</span></span>
<span><span class="va">cc2</span> <span class="op">&lt;-</span> <span class="va">BR</span></span>
<span><span class="va">cc2</span> <span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">cc2</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">" "</span>, <span class="st">"_"</span>, <span class="va">x</span><span class="op">)</span> <span class="op">)</span></span>
<span></span>
<span><span class="co"># creating BR.maps to store the amalagamations</span></span>
<span><span class="va">BR.maps</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">vector</a></span><span class="op">(</span><span class="st">"list"</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">BR</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">BR.maps</span><span class="op">)</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">BR</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># run amalgamation using the renamed outputs from RAC query</span></span>
<span><span class="co"># this loop construct one amalgamation for each BR term</span></span>
<span><span class="co"># the number of amalgamations per term can be specified using `ntrees=`</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">BR.maps</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">{</span></span>
<span>  <span class="va">map</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/paramo.list.html">paramo.list</a></span><span class="op">(</span><span class="va">cc2</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>, <span class="va">IND.maps</span>, ntrees<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span>  <span class="va">BR.maps</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">&lt;-</span><span class="va">map</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">#############</span></span>
<span><span class="co"># Amalgamation at the EF level</span></span>
<span><span class="co">#############</span></span>
<span><span class="co"># we use the ouput `EF` from the RAC query obtained at Step 3. </span></span>
<span><span class="co"># This ouput contains character IDs for EF term</span></span>
<span><span class="co"># Let's rename those IDs to match the file names of the stochastic maps</span></span>
<span><span class="va">cc3</span> <span class="op">&lt;-</span> <span class="va">EF</span></span>
<span><span class="va">cc3</span> <span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">cc3</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">" "</span>, <span class="st">"_"</span>, <span class="va">x</span><span class="op">)</span> <span class="op">)</span></span>
<span></span>
<span><span class="co"># creating EF.maps to store the amalagamations</span></span>
<span><span class="va">EF.maps</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">vector</a></span><span class="op">(</span><span class="st">"list"</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">EF</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">EF.maps</span><span class="op">)</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">EF</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># run amalgamation using the renamed outputs from RAC query</span></span>
<span><span class="co"># this code will return 1 amalgamated stochastic map of the EF character</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">EF.maps</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">{</span></span>
<span>  <span class="va">map</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/paramo.list.html">paramo.list</a></span><span class="op">(</span><span class="va">cc3</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>, <span class="va">IND.maps</span>, ntrees<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span>  <span class="va">EF.maps</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">&lt;-</span><span class="va">map</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>If you skipped the steps above, no problem, we can simply load the
pre-cooked data.</p>
<div class="sourceCode" id="cb62"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">IND.maps</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">EF.maps</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">BR.maps</span><span class="op">)</span></span></code></pre></div>
<p>Let’s plot and view the results!</p>
<div class="sourceCode" id="cb63"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#########</span></span>
<span><span class="co"># Individual Traits Level</span></span>
<span><span class="co">########</span></span>
<span><span class="co"># Set up a pretty color palette</span></span>
<span><span class="va">hm.palette</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/colorRamp.html" class="external-link">colorRampPalette</a></span><span class="op">(</span><span class="fu">RColorBrewer</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/RColorBrewer/man/ColorBrewer.html" class="external-link">brewer.pal</a></span><span class="op">(</span><span class="fl">9</span>, <span class="st">'Set1'</span><span class="op">)</span>, space<span class="op">=</span><span class="st">'Lab'</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">ymax</span> <span class="op">&lt;-</span> <span class="fl">1.1</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">td.comb</span><span class="op">$</span><span class="va">phy</span><span class="op">$</span><span class="va">tip.label</span><span class="op">)</span> <span class="co">#set our boundaries for our plot area</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">char_info_comb</span><span class="op">$</span><span class="va">ID</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">trait</span> <span class="op">&lt;-</span> <span class="va">char_info_comb</span><span class="op">$</span><span class="va">ID</span><span class="op">[</span><span class="va">i</span><span class="op">]</span></span>
<span>  <span class="va">trait</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">" "</span>, <span class="st">"_"</span>, <span class="va">trait</span><span class="op">)</span></span>
<span>  <span class="co">#map &lt;- paramo(trait, ntrees=1, dirW=dirW)</span></span>
<span>  <span class="va">map</span> <span class="op">&lt;-</span> <span class="va">IND.maps</span><span class="op">[[</span><span class="va">trait</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="va">states</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">map</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">maps</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">states</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="fu">phytools</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/phytools/man/plotSimmap.html" class="external-link">plotSimmap</a></span><span class="op">(</span><span class="va">map</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, pts<span class="op">=</span><span class="cn">F</span>,ftype<span class="op">=</span><span class="st">"off"</span>, colors<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/setNames.html" class="external-link">setNames</a></span><span class="op">(</span><span class="fu">hm.palette</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">states</span><span class="op">)</span><span class="op">)</span>, <span class="va">states</span><span class="op">)</span>, ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">ymax</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/title.html" class="external-link">title</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"\n\n "</span>, <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"_"</span>, <span class="st">" "</span>, <span class="va">trait</span><span class="op">)</span><span class="op">)</span>, cex.main<span class="op">=</span><span class="fl">0.8</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "1" "0"</span></span></code></pre>
<pre><code><span><span class="co">## [1] "0" "1"</span></span></code></pre>
<p><img src="PARAMO_files/figure-html/unnamed-chunk-18-1.png" width="700"></p>
<pre><code><span><span class="co">## [1] "0" "1"</span></span></code></pre>
<pre><code><span><span class="co">## [1] "0" "4" "6" "7" "5"</span></span></code></pre>
<p><img src="PARAMO_files/figure-html/unnamed-chunk-18-2.png" width="700"></p>
<pre><code><span><span class="co">## [1] "0" "1"</span></span></code></pre>
<pre><code><span><span class="co">## [1] "0" "1"</span></span></code></pre>
<p><img src="PARAMO_files/figure-html/unnamed-chunk-18-3.png" width="700"></p>
<pre><code><span><span class="co">## [1] "7" "5" "4" "6"</span></span></code></pre>
<pre><code><span><span class="co">##  [1] "15" "14" "13" "5"  "9"  "7"  "12" "6"  "2"  "0"  "8"</span></span></code></pre>
<p><img src="PARAMO_files/figure-html/unnamed-chunk-18-4.png" width="700"></p>
<pre><code><span><span class="co">## [1] "5" "7"</span></span></code></pre>
<p><img src="PARAMO_files/figure-html/unnamed-chunk-18-5.png" width="700"></p>
<div class="sourceCode" id="cb73"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#########</span></span>
<span><span class="co"># BR level</span></span>
<span><span class="co">########</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># plot one stochastic maps for the head character</span></span>
<span><span class="va">states</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">BR.maps</span><span class="op">$</span><span class="va">dermatocranium</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">maps</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">phytools</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/phytools/man/plotSimmap.html" class="external-link">plotSimmap</a></span><span class="op">(</span><span class="va">BR.maps</span><span class="op">$</span><span class="va">dermatocranium</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, pts<span class="op">=</span><span class="cn">F</span>,ftype<span class="op">=</span><span class="st">"off"</span>,  colors<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/setNames.html" class="external-link">setNames</a></span><span class="op">(</span><span class="fu">hm.palette</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">states</span><span class="op">)</span><span class="op">)</span>, <span class="va">states</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/title.html" class="external-link">title</a></span><span class="op">(</span><span class="st">"\n Dermatocranium character"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># plot one stochastic maps for the wings character</span></span>
<span><span class="va">states</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">BR.maps</span><span class="op">$</span><span class="st">'paired fin'</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">maps</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">phytools</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/phytools/man/plotSimmap.html" class="external-link">plotSimmap</a></span><span class="op">(</span><span class="va">BR.maps</span><span class="op">$</span><span class="va">`paired fin`</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, pts<span class="op">=</span><span class="cn">F</span>,ftype<span class="op">=</span><span class="st">"off"</span>, colors<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/setNames.html" class="external-link">setNames</a></span><span class="op">(</span><span class="fu">hm.palette</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">states</span><span class="op">)</span><span class="op">)</span>, <span class="va">states</span><span class="op">)</span> <span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/title.html" class="external-link">title</a></span><span class="op">(</span><span class="st">"\n Paired Fin character"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># plot one stochastic maps for the legs character</span></span>
<span><span class="va">states</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">BR.maps</span><span class="op">$</span><span class="va">`external integument structure`</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">maps</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">phytools</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/phytools/man/plotSimmap.html" class="external-link">plotSimmap</a></span><span class="op">(</span><span class="va">BR.maps</span><span class="op">$</span><span class="va">`external integument structure`</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, pts<span class="op">=</span><span class="cn">F</span>,ftype<span class="op">=</span><span class="st">"off"</span>, colors<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/setNames.html" class="external-link">setNames</a></span><span class="op">(</span><span class="fu">hm.palette</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">states</span><span class="op">)</span><span class="op">)</span>, <span class="va">states</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/title.html" class="external-link">title</a></span><span class="op">(</span><span class="st">"\n Barbel character"</span><span class="op">)</span></span></code></pre></div>
<p><img src="PARAMO_files/figure-html/unnamed-chunk-19-1.png" width="700"></p>
<div class="sourceCode" id="cb74"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#########</span></span>
<span><span class="co"># EF level</span></span>
<span><span class="co">#########</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># plot one stochastic maps for the entire phenotype character</span></span>
<span><span class="co"># first, let's define color pallette for the characters since it contains many states</span></span>
<span><span class="va">tmm</span><span class="op">&lt;-</span><span class="va">EF.maps</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="va">states</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">tmm</span><span class="op">$</span><span class="va">maps</span>, <span class="va">names</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># number of states in the character</span></span>
<span><span class="co">#length(states)</span></span>
<span></span>
<span><span class="va">color</span><span class="op">&lt;-</span><span class="fu">hm.palette</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">states</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">phytools</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/phytools/man/plotSimmap.html" class="external-link">plotSimmap</a></span><span class="op">(</span><span class="va">tmm</span>, <span class="fu"><a href="https://rdrr.io/r/stats/setNames.html" class="external-link">setNames</a></span><span class="op">(</span><span class="va">color</span>, <span class="va">states</span><span class="op">)</span>,  lwd<span class="op">=</span><span class="fl">3</span>, pts<span class="op">=</span><span class="cn">F</span>,ftype<span class="op">=</span><span class="st">"off"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/title.html" class="external-link">title</a></span><span class="op">(</span><span class="st">"\n Entire Phenotype character"</span><span class="op">)</span></span></code></pre></div>
<p><img src="PARAMO_files/figure-html/unnamed-chunk-20-1.png" width="700"></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Hilmar Lapp, Wasila Dahdul, Josef Uyeda.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.5.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
